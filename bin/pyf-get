#!/usr/bin/python3

import argparse
import sys
import bs4
import configparser
import requests

import pyfortunes.config

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("category", nargs="?")
    args = parser.parse_args()
    display_fortune(category=args.category)

def display_fortune(category=None):
    config = pyfortunes.config.get_config()
    url = config["server"]["url"]
    url = url + "/fortune"
    if category:
        url += "/%s" % category
    as_html = requests.get(url).text
    soup = bs4.BeautifulSoup(as_html, "html.parser")
    pre = soup.find("pre").text
    # remove leading \n
    print(pre[1:], end="")
    ref = soup.find("a").text
    print(ref.strip())

if __name__ == "__main__":
    main()
