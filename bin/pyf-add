#!/usr/bin/python3

import pyfortunes
import argparse

def main():
    parser = argparse.ArgumentParser()
    pyfortunes.client.configure_parser(parser)
    parser.add_argument('text_file', nargs='?',
        help='Path where to read the fortune text',
        type=argparse.FileType('r')
    )
    parser.add_argument('--category',
        help='Category of the fortune'
    )
    args = parser.parse_args()
    url = args.url
    text_fp  = args.text_file
    category = args.category
    if text_fp:
        text = text_fp.read()
        text_fp.close()
    else:
        text = None
    proxy = pyfortunes.client.get_proxy(url)
    pyfortunes.client.add_fortune(proxy, text=text, category=category)

if __name__ == "__main__":
    main()
